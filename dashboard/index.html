<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jarvis OS â€” Mission Control</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>

<div class="app-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">âš¡</div>
      <div>
        <h1>Jarvis OS</h1>
        <span>Mission Control v1.0</span>
      </div>
    </div>

    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Overview</div>
        <div class="nav-item active" data-page="dashboard">
          <span class="nav-icon">ğŸ“Š</span> Dashboard
        </div>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Chat</div>
        <div class="nav-item" data-page="jarvis-chat">
          <span class="nav-icon">âš¡</span> Jarvis
          <span class="badge" style="background:var(--green)">online</span>
        </div>
        <div class="nav-item" data-page="agents">
          <span class="nav-icon">ğŸ¤–</span> Agents
          <span class="badge" id="agent-count-badge">0</span>
        </div>
        <div class="nav-item" data-page="hub">
          <span class="nav-icon">ğŸŒ</span> Agent Hub
        </div>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">System</div>
        <div class="nav-item" data-page="memory">
          <span class="nav-icon">ğŸ§ </span> Memory
        </div>
        <div class="nav-item" data-page="logs">
          <span class="nav-icon">ğŸ“‹</span> Logs
        </div>
        <div class="nav-item" data-page="settings">
          <span class="nav-icon">âš™ï¸</span> Settings
        </div>
        <div class="nav-item" data-page="plugins">
          <span class="nav-icon">ğŸ”Œ</span> Plugins
        </div>
      </div>
    </nav>
  </aside>

  <!-- Main -->
  <main class="main-content">

    <!-- â•â•â•â•â•â•â•â• DASHBOARD PAGE â•â•â•â•â•â•â•â• -->
    <div id="page-dashboard" class="page">
      <div class="main-header">
        <h2>Dashboard</h2>
        <div class="header-actions">
          <button class="btn btn-primary" onclick="navigateTo('jarvis-chat')">
            âš¡ Chat with Jarvis
          </button>
        </div>
      </div>
      <div class="page-content fade-in">
        <!-- Stats -->
        <div class="grid grid-4" style="margin-bottom: 24px">
          <div class="stat-card clickable" onclick="navigateTo('jarvis-chat')">
            <div class="stat-label">Jarvis</div>
            <div class="stat-value" style="font-size:1.4rem; color:var(--green)">â— Online</div>
            <div class="stat-change positive">Ready to chat</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Active Agents</div>
            <div class="stat-value" id="stat-active">0</div>
            <div class="stat-change positive" id="stat-active-note">No agents yet</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Memory Entries</div>
            <div class="stat-value" id="stat-memory">0</div>
            <div class="stat-change">Conversations + knowledge</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">LLM Provider</div>
            <div class="stat-value" id="stat-provider" style="font-size:1.2rem">Not configured</div>
            <div class="stat-change" id="stat-model-note">Set up in Settings</div>
          </div>
        </div>

        <!-- Quick actions -->
        <div class="card" style="margin-bottom:24px">
          <div class="card-header">
            <h3 class="card-title">Quick Start</h3>
          </div>
          <div class="grid grid-3">
            <div class="quick-action" onclick="navigateTo('jarvis-chat')">
              <div class="quick-action-icon">ğŸ’¬</div>
              <div class="quick-action-title">Chat with Jarvis</div>
              <div class="quick-action-desc">Ask anything, create agents, get help</div>
            </div>
            <div class="quick-action" onclick="openNewAgentModal()">
              <div class="quick-action-icon">ğŸ¤–</div>
              <div class="quick-action-title">Create Agent</div>
              <div class="quick-action-desc">Spawn a specialized AI agent</div>
            </div>
            <div class="quick-action" onclick="navigateTo('hub')">
              <div class="quick-action-icon">ğŸŒ</div>
              <div class="quick-action-title">Agent Hub</div>
              <div class="quick-action-desc">Watch agents collaborate</div>
            </div>
          </div>
        </div>

        <!-- Recent agents -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Your Agents</h3>
            <button class="btn btn-secondary btn-sm" onclick="openNewAgentModal()">Create New</button>
          </div>
          <div id="dashboard-agents-list">
            <div class="empty-state" style="padding:30px">
              <p style="color:var(--text-muted)">No agents yet. Chat with Jarvis and ask him to create one, or use the Create Agent button.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• JARVIS CHAT PAGE (Always available) â•â•â•â•â•â•â•â• -->
    <div id="page-jarvis-chat" class="page hidden">
      <div class="main-header">
        <h2>âš¡ Jarvis</h2>
        <div class="header-actions">
          <span class="status status-running" id="jarvis-connection-status">
            <span class="status-dot"></span>
            Connected
          </span>
        </div>
      </div>
      <div class="page-content" style="padding:0 0 0 0; height:calc(100vh - var(--header-h))">
        <div class="chat-container" style="height:100%; border:none; border-radius:0">
          <div class="chat-messages" id="jarvis-messages">
            <div class="jarvis-welcome">
              <div class="jarvis-welcome-icon">âš¡</div>
              <h2>Hey, I'm Jarvis</h2>
              <p>Your AI operating system. I can help you with anything â€” ask me questions, create agents, search the web, write code, or just chat.</p>
              <div class="jarvis-suggestions">
                <button class="suggestion-chip" onclick="sendJarvisMessage('What can you do?')">What can you do?</button>
                <button class="suggestion-chip" onclick="sendJarvisMessage('Create a trading agent for crypto')">Create a trading agent</button>
                <button class="suggestion-chip" onclick="sendJarvisMessage('Search the web for the latest AI news')">Search latest AI news</button>
                <button class="suggestion-chip" onclick="sendJarvisMessage('Help me write a Python script')">Help me write code</button>
              </div>
            </div>
          </div>
          <div id="jarvis-image-preview" class="image-preview-strip" style="display:none"></div>
          <div class="chat-input-area">
            <input type="file" id="jarvis-file-input" accept="image/*" multiple style="display:none" onchange="handleJarvisFiles(this.files)">
            <button class="chat-attach-btn" onclick="document.getElementById('jarvis-file-input').click()" title="Attach image">ğŸ“</button>
            <textarea id="jarvis-input" placeholder="Message Jarvis... (paste images with Ctrl+V)" rows="1" onkeydown="handleJarvisKey(event)" onpaste="handleJarvisPaste(event)"></textarea>
            <button class="chat-send-btn" id="jarvis-send" onclick="sendJarvisMessage()">â†‘</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• AGENTS PAGE â•â•â•â•â•â•â•â• -->
    <div id="page-agents" class="page hidden">
      <div class="main-header">
        <h2>ğŸ¤– Agents</h2>
        <div class="header-actions">
          <button class="btn btn-primary" onclick="openNewAgentModal()">â• New Agent</button>
        </div>
      </div>
      <div class="page-content fade-in">
        <div class="grid grid-3" id="agents-grid">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• AGENT CHAT PAGE â•â•â•â•â•â•â•â• -->
    <div id="page-chat" class="page hidden">
      <div class="main-header">
        <h2>ğŸ’¬ <span id="chat-agent-name">Agent</span></h2>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" onclick="navigateTo('agents')">â† Back to Agents</button>
        </div>
      </div>
      <div class="page-content" style="padding:0; height:calc(100vh - var(--header-h))">
        <div class="chat-container" style="height:100%; border:none; border-radius:0">
          <div class="chat-messages" id="chat-messages"></div>
          <div class="chat-input-area">
            <textarea id="chat-input" placeholder="Type a message..." rows="1" onkeydown="handleChatKey(event)"></textarea>
            <button class="chat-send-btn" id="chat-send" onclick="sendMessage()">â†‘</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• AGENT HUB PAGE â•â•â•â•â•â•â•â• -->
    <div id="page-hub" class="page hidden">
      <div class="main-header">
        <h2>ğŸŒ Agent Hub</h2>
        <div class="header-actions">
          <span class="status status-running"><span class="status-dot"></span> Live</span>
        </div>
      </div>
      <div class="page-content" style="padding:0; height:calc(100vh - var(--header-h))">
        <div class="hub-layout">
          <!-- Agent sidebar -->
          <div class="hub-agents">
            <div class="hub-agents-header">
              <h3>Participants</h3>
            </div>
            <div class="hub-agent-list" id="hub-agent-list">
              <div class="hub-agent-item active" data-agent="jarvis">
                <div class="hub-agent-avatar jarvis">âš¡</div>
                <div class="hub-agent-info">
                  <div class="hub-agent-name">Jarvis</div>
                  <div class="hub-agent-role">Orchestrator</div>
                </div>
                <span class="status-dot" style="color:var(--green)"></span>
              </div>
              <!-- Dynamic agents added here -->
            </div>
          </div>
          <!-- Group chat -->
          <div class="hub-chat">
            <div class="hub-messages" id="hub-messages">
              <div class="hub-system-msg">
                <span>ğŸŒ Agent Hub â€” All agents can communicate here. Jarvis orchestrates.</span>
              </div>
            </div>
            <div class="chat-input-area">
              <textarea id="hub-input" placeholder="Message the group..." rows="1" onkeydown="handleHubKey(event)"></textarea>
              <button class="chat-send-btn" onclick="sendHubMessage()">â†‘</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• LOGS PAGE â•â•â•â•â•â•â•â• -->
    <div id="page-logs" class="page hidden">
      <div class="main-header">
        <h2>ğŸ“‹ Activity Logs</h2>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" onclick="clearLogs()">Clear</button>
        </div>
      </div>
      <div class="page-content fade-in">
        <div class="log-viewer" id="log-viewer"></div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• MEMORY PAGE â•â•â•â•â•â•â•â• -->
    <div id="page-memory" class="page hidden">
      <div class="main-header">
        <h2>ğŸ§  Agent Memory</h2>
      </div>
      <div class="page-content fade-in">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Search Memory</h3>
          </div>
          <div class="form-input-group" style="margin-bottom: 20px">
            <input type="text" class="form-input" id="memory-search" placeholder="Search knowledge, conversations..." onkeydown="if(event.key==='Enter')searchMemory()">
            <button class="btn btn-primary" onclick="searchMemory()">Search</button>
          </div>
          <div id="memory-results">
            <p style="color: var(--text-muted)">Search to find stored knowledge and conversations.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• SETTINGS PAGE â•â•â•â•â•â•â•â• -->
    <div id="page-settings" class="page hidden">
      <div class="main-header">
        <h2>âš™ï¸ Settings</h2>
      </div>
      <div class="page-content fade-in">
        <div class="tabs">
          <div class="tab active" data-tab="api-keys">API Keys</div>
          <div class="tab" data-tab="general">General</div>
          <div class="tab" data-tab="integrations">Integrations</div>
        </div>

        <!-- API Keys Tab -->
        <div id="tab-api-keys" class="tab-content">
          <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 0.9rem">
            Configure your LLM provider API keys. Keys are saved to .env on the server.
          </p>

          <div class="api-key-card">
            <div class="provider-icon" style="background: rgba(0,166,126,0.15)">ğŸŸ¢</div>
            <div class="provider-info">
              <div class="provider-name">OpenAI</div>
              <div class="provider-status" id="openai-status" style="color: var(--text-muted)">Not configured</div>
            </div>
            <input type="password" class="form-input key-input" id="key-openai" placeholder="sk-..." style="max-width:260px">
            <button class="btn btn-secondary btn-sm" onclick="saveApiKey('openai')">Save</button>
          </div>

          <div class="api-key-card">
            <div class="provider-icon" style="background: rgba(204,120,50,0.15)">ğŸŸ </div>
            <div class="provider-info">
              <div class="provider-name">Anthropic</div>
              <div class="provider-status" id="anthropic-status" style="color: var(--text-muted)">Not configured</div>
            </div>
            <input type="password" class="form-input key-input" id="key-anthropic" placeholder="sk-ant-..." style="max-width:260px">
            <button class="btn btn-secondary btn-sm" onclick="saveApiKey('anthropic')">Save</button>
          </div>

          <div class="api-key-card">
            <div class="provider-icon" style="background: rgba(99,102,241,0.15)">ğŸŸ£</div>
            <div class="provider-info">
              <div class="provider-name">Ollama (Local)</div>
              <div class="provider-status" id="ollama-status" style="color: var(--text-muted)">Free â€” runs on your GPU</div>
            </div>
            <input type="text" class="form-input key-input" id="key-ollama" placeholder="http://localhost:11434" style="max-width:260px" value="http://localhost:11434">
            <button class="btn btn-secondary btn-sm" onclick="saveApiKey('ollama')">Test</button>
          </div>

          <div class="api-key-card">
            <div class="provider-icon" style="background: rgba(66,133,244,0.15)">ğŸ”µ</div>
            <div class="provider-info">
              <div class="provider-name">Google Gemini</div>
              <div class="provider-status" id="google-status" style="color: var(--text-muted)">Not configured</div>
            </div>
            <input type="password" class="form-input key-input" id="key-google" placeholder="AI..." style="max-width:260px">
            <button class="btn btn-secondary btn-sm" onclick="saveApiKey('google')">Save</button>
          </div>
        </div>

        <!-- General Tab -->
        <div id="tab-general" class="tab-content hidden">
          <div class="card" style="max-width:600px">
            <div class="form-group">
              <label class="form-label">Default Model</label>
              <select class="form-select" id="setting-default-model">
                <optgroup label="OpenAI â€” GPT-5">
                  <option value="gpt-5.2">GPT-5.2</option>
                  <option value="gpt-5.1">GPT-5.1</option>
                  <option value="gpt-5-mini">GPT-5 Mini</option>
                </optgroup>
                <optgroup label="Anthropic">
                  <option value="claude-opus-4-6">Claude Opus 4.6</option>
                  <option value="claude-sonnet-4-5-20250929">Claude Sonnet 4.5</option>
                </optgroup>
                <optgroup label="Google">
                  <option value="gemini-3-pro">Gemini 3 Pro</option>
                </optgroup>
                <optgroup label="Ollama (Free)">
                  <option value="llama3.1">Llama 3.1</option>
                </optgroup>
              </select>
            </div>
            <div class="form-group">
              <label class="toggle">
                <input type="checkbox" id="setting-auto-memory" checked>
                <span class="toggle-track"></span>
                Auto-save conversations to memory
              </label>
            </div>
            <button class="btn btn-primary" onclick="saveGeneralSettings()">Save Settings</button>
          </div>
        </div>

        <!-- Integrations Tab -->
        <div id="tab-integrations" class="tab-content hidden">
          <div class="grid grid-2">
            <div class="api-key-card" style="flex-direction:column; align-items:flex-start; gap:12px">
              <div style="display:flex; align-items:center; gap:12px">
                <div class="provider-icon" style="background:rgba(74,21,75,0.2)">ğŸ’¬</div>
                <div><div class="provider-name">Slack</div><div class="provider-status" style="color:var(--text-muted)">Bot token</div></div>
              </div>
              <input type="password" class="form-input" id="key-slack" placeholder="xoxb-..." style="width:100%">
              <button class="btn btn-secondary btn-sm" onclick="saveApiKey('slack')">Save</button>
            </div>
            <div class="api-key-card" style="flex-direction:column; align-items:flex-start; gap:12px">
              <div style="display:flex; align-items:center; gap:12px">
                <div class="provider-icon" style="background:rgba(29,161,242,0.15)">ğŸ¦</div>
                <div><div class="provider-name">Twitter / X</div><div class="provider-status" style="color:var(--text-muted)">API key</div></div>
              </div>
              <input type="password" class="form-input" id="key-twitter" placeholder="API key..." style="width:100%">
              <button class="btn btn-secondary btn-sm" onclick="saveApiKey('twitter')">Save</button>
            </div>
            <div class="api-key-card" style="flex-direction:column; align-items:flex-start; gap:12px">
              <div style="display:flex; align-items:center; gap:12px">
                <div class="provider-icon" style="background:rgba(255,255,255,0.08)">ğŸ™</div>
                <div><div class="provider-name">GitHub</div><div class="provider-status" style="color:var(--text-muted)">Token</div></div>
              </div>
              <input type="password" class="form-input" id="key-github" placeholder="ghp_..." style="width:100%">
              <button class="btn btn-secondary btn-sm" onclick="saveApiKey('github')">Save</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â• PLUGINS PAGE â•â•â•â•â•â•â•â• -->
    <div id="page-plugins" class="page hidden">
      <div class="main-header">
        <h2>ğŸ”Œ Plugins</h2>
      </div>
      <div class="page-content fade-in">
        <div class="card" style="margin-bottom: 20px">
          <div class="card-header">
            <h3 class="card-title">Loaded Plugins</h3>
          </div>
          <div id="plugins-list"></div>
        </div>
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Create a Plugin</h3>
          </div>
          <div class="log-viewer" style="max-height:200px">
<span style="color:var(--text-muted)"># plugins/my_tool.py</span>
<span style="color:var(--cyan)">from</span> jarvis.plugins <span style="color:var(--cyan)">import</span> plugin_tool

<span style="color:var(--green)">@plugin_tool(</span>
    name=<span style="color:var(--orange)">"my_tool"</span>,
    description=<span style="color:var(--orange)">"What it does"</span>,
    parameters={<span style="color:var(--orange)">"input"</span>: <span style="color:var(--orange)">"Description"</span>}
<span style="color:var(--green)">)</span>
<span style="color:var(--cyan)">async def</span> <span style="color:var(--accent)">my_tool</span>(input: str) -> str:
    <span style="color:var(--cyan)">return</span> f<span style="color:var(--orange)">"Result: {input}"</span>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- â•â•â•â•â•â•â•â• NEW AGENT MODAL â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="new-agent-modal">
  <div class="modal">
    <h3 class="modal-title">Create New Agent</h3>
    <p class="modal-subtitle">Choose a template and model for your agent.</p>

    <div class="form-group">
      <label class="form-label">Agent Name</label>
      <input type="text" class="form-input" id="new-agent-name" placeholder="my-trading-bot">
    </div>

    <div class="form-group">
      <label class="form-label">Template</label>
      <div class="template-grid" id="template-picker">
        <div class="template-option selected" data-template="trading">
          <div class="template-icon">ğŸ’¹</div>
          <div class="template-name">Trading</div>
          <div class="template-desc">Crypto & analysis</div>
        </div>
        <div class="template-option" data-template="research">
          <div class="template-icon">ğŸ”¬</div>
          <div class="template-name">Research</div>
          <div class="template-desc">Deep research</div>
        </div>
        <div class="template-option" data-template="content">
          <div class="template-icon">âœï¸</div>
          <div class="template-name">Content</div>
          <div class="template-desc">Writing & social</div>
        </div>
        <div class="template-option" data-template="devops">
          <div class="template-icon">ğŸ› ï¸</div>
          <div class="template-name">DevOps</div>
          <div class="template-desc">Infra & monitoring</div>
        </div>
        <div class="template-option" data-template="support">
          <div class="template-icon">ğŸ§</div>
          <div class="template-name">Support</div>
          <div class="template-desc">Customer support</div>
        </div>
        <div class="template-option" data-template="personal-assistant">
          <div class="template-icon">ğŸ§‘â€ğŸ’¼</div>
          <div class="template-name">Assistant</div>
          <div class="template-desc">Personal AI</div>
        </div>
        <div class="template-option" data-template="custom">
          <div class="template-icon">âš¡</div>
          <div class="template-name">Custom</div>
          <div class="template-desc">From scratch</div>
        </div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">LLM Model</label>
      <select class="form-select" id="new-agent-model">
        <optgroup label="OpenAI â€” GPT-5">
          <option value="gpt-5.2" selected>GPT-5.2 â€” Latest</option>
          <option value="gpt-5.1">GPT-5.1</option>
          <option value="gpt-5-mini">GPT-5 Mini â€” Fast</option>
        </optgroup>
        <optgroup label="OpenAI â€” Reasoning">
          <option value="o4-mini">o4-mini</option>
          <option value="o3-pro">o3-pro</option>
        </optgroup>
        <optgroup label="Anthropic">
          <option value="claude-opus-4-6">Claude Opus 4.6</option>
          <option value="claude-sonnet-4-5-20250929">Claude Sonnet 4.5</option>
          <option value="claude-haiku-4-5-20251001">Claude Haiku 4.5</option>
        </optgroup>
        <optgroup label="Google">
          <option value="gemini-3-pro">Gemini 3 Pro</option>
          <option value="gemini-3-flash">Gemini 3 Flash</option>
        </optgroup>
        <optgroup label="Ollama (Free)">
          <option value="llama3.1">Llama 3.1 8B</option>
          <option value="mistral">Mistral 7B</option>
        </optgroup>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">Personality (optional)</label>
      <textarea class="form-textarea" id="new-agent-personality" rows="2" placeholder="Describe how the agent should behave..."></textarea>
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeNewAgentModal()">Cancel</button>
      <button class="btn btn-primary" onclick="createAgent()">ğŸš€ Create Agent</button>
    </div>
  </div>
</div>

<div class="toast-container" id="toast-container"></div>

<script src="/static/js/app.js"></script>
</body>
</html>
